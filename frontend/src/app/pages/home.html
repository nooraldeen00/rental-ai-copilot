<div class="page">
  <header class="page-header">
    <div>
      <div class="header-top-line">
        <span class="header-dot"></span>
        <span>AI Quote Copilot • Beta</span>
      </div>
      <h1 class="page-title">
        Point of Rental <span>AI Quote Copilot</span>
      </h1>
      <p class="page-subtitle">
        Paste a renter request and let the copilot infer items, apply tier policies, and compute totals —
        just like a CSR would.
      </p>
    </div>
    <p class="header-tagline">
      Runs entirely in this demo environment. Model decisions and line items are logged for review.
    </p>
  </header>

  <main class="layout">
    <!-- LEFT: FORM -->
    <section class="card">
      <h2>Create Draft Quote</h2>
      <p class="card-subtitle">
        Fill in the renter details and let the copilot build the quote.
      </p>

      <form class="form-section" (ngSubmit)="onSubmit()" #quoteForm="ngForm">
        <!-- Renter request -->
        <div>
          <label class="field-label">Renter request</label>
          <textarea
            class="textarea"
            [(ngModel)]="form.request_text"
            name="request_text"
            placeholder="Example: We need 30 chairs and 5 round tables for a weekend event in Dallas."
            required
          ></textarea>
        </div>

        <!-- Tier / Location / Seed -->
        <div class="form-row-3">
          <div>
            <label class="field-label">Tier</label>
            <select
              class="select"
              [(ngModel)]="form.customer_tier"
              name="customer_tier"
            >
              <option value="A">A – Top</option>
              <option value="B">B – Standard</option>
              <option value="C">C – Budget</option>
            </select>
          </div>

          <div>
            <label class="field-label">Location (city)</label>
            <input
              class="input"
              [(ngModel)]="form.location"
              name="location"
              placeholder="Dallas"
            />
          </div>

          <div>
            <label class="field-label">Seed (optional)</label>
            <input
              class="input"
              [(ngModel)]="form.seed"
              name="seed"
              type="number"
              placeholder="e.g. 1"
            />
          </div>
        </div>

        <!-- Dates + ZIP -->
        <div class="form-row-3">
          <div>
            <label class="field-label">Start date</label>
            <input
              class="input"
              [(ngModel)]="form.start_date"
              name="start_date"
              type="date"
            />
          </div>
          <div>
            <label class="field-label">End date</label>
            <input
              class="input"
              [(ngModel)]="form.end_date"
              name="end_date"
              type="date"
            />
          </div>
          <div>
            <label class="field-label">ZIP</label>
            <input
              class="input"
              [(ngModel)]="form.zip"
              name="zip"
              placeholder="75201"
            />
          </div>
        </div>

        <!-- Buttons + hint -->
        <div class="btn-row">
          <button
            type="submit"
            class="btn-primary"
            [disabled]="loading || !quoteForm.form.valid"
          >
            <span *ngIf="!loading">Generate Quote</span>
            <span *ngIf="loading">
              <span class="spinner"></span> Running…
            </span>
          </button>

          <button type="button" class="btn-secondary" (click)="onClear()">
            Clear
          </button>

          <span class="form-hint">
            Model decisions and line items are logged for review in this demo.
          </span>
        </div>

        <p *ngIf="error" class="error-text">
          {{ error }}
        </p>
      </form>
    </section>

    <!-- RIGHT: PREVIEW -->
    <section class="card">
      <h2>Quote Preview</h2>
      <p class="card-subtitle">
        Generated from the renter request in real time.
      </p>

      <!-- Empty state -->
      <div
        *ngIf="!result && !loading && !error"
        class="preview-empty"
      >
        Paste a renter request and click <strong>Generate Quote</strong> to see items, fees, and totals appear here.
      </div>

      <!-- Loading -->
      <div *ngIf="loading" class="preview-loading">
        <span class="spinner"></span>
        <span>Asking the copilot to build your quote…</span>
      </div>

      <!-- Error -->
      <div *ngIf="error && !loading" class="preview-error">
        Request failed. {{ error }}
      </div>

      <!-- Result -->
      <ng-container *ngIf="result?.quote as q">
        <div class="preview-body">
          <div class="preview-summary-line">
            <div>
              <div class="preview-total-label">Summary</div>
              <div>
                Draft quote for
                <strong>{{ form.location || 'event location' }}</strong>
                (Tier {{ form.customer_tier || 'C' }}).
              </div>
            </div>
            <div>
              <div class="preview-total-label">Estimated total</div>
              <div class="preview-total">
                {{ q.total || 0 | number : '1.2-2' }}
              </div>
              <div class="preview-subcaption">
                Subtotal {{ q.subtotal || 0 | number : '1.2-2' }} · Tax
                {{ q.tax || 0 | number : '1.2-2' }}
              </div>
            </div>
          </div>

          <!-- Items table -->
          <div *ngIf="q.items?.length">
            <table class="preview-table">
              <thead>
                <tr>
                  <th>Item</th>
                  <th style="text-align: right;">Qty</th>
                  <th style="text-align: right;">Unit</th>
                  <th style="text-align: right;">Extended</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of q.items">
                  <td>
                    <div>{{ item.name }}</div>
                    <div *ngIf="item.sku" style="font-size: 0.7rem; color: #9ca3af;">
                      SKU: {{ item.sku }}
                    </div>
                  </td>
                  <td style="text-align: right;">
                    {{ item.quantity }}
                  </td>
                  <td style="text-align: right;">
                    {{ item.unit_price | number : '1.2-2' }}
                  </td>
                  <td style="text-align: right;">
                    {{ item.extended | number : '1.2-2' }}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Fees -->
          <div *ngIf="q.fees?.length" class="preview-fees">
            <div class="preview-total-label">Fees &amp; adjustments</div>
            <div
              *ngFor="let f of q.fees"
              class="preview-fees-row"
            >
              <span class="preview-fees-label">{{ f.name }}</span>
              <span class="preview-fees-value">
                {{ f.amount | number : '1.2-2' }}
              </span>
            </div>
          </div>
        </div>
      </ng-container>
    </section>
  </main>
</div>
