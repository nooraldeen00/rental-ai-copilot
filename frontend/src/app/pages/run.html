<div class="container-app">
  <!-- Header -->
  <header class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-semibold tracking-tight">Quote Copilot</h1>
      <p class="text-sm text-white/60">Run a rental quote and see AI insights.</p>
    </div>
    <div class="flex items-center gap-2">
      <span class="status-dot"></span>
      <span class="badge">Live</span>
    </div>
  </header>

  <!-- Body -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Left: Form -->
    <section class="card">
      <form class="section" (ngSubmit)="onRun()" #f="ngForm">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <label class="label">Start date
            <input class="input mt-1" type="date" [(ngModel)]="model.start_date" name="start_date" required />
          </label>

          <label class="label">End date
            <input class="input mt-1" type="date" [(ngModel)]="model.end_date" name="end_date" required />
          </label>

          <label class="label">Customer tier
            <select class="select mt-1" [(ngModel)]="model.customer_tier" name="customer_tier" required>
              <option value="A">A (VIP)</option>
              <option value="B">B</option>
              <option value="C">C</option>
            </select>
            <div class="help mt-1">Tiers may affect pricing/availability.</div>
          </label>

          <label class="label">ZIP
            <input class="input mt-1" type="text" [(ngModel)]="model.zip" name="zip" placeholder="76019" />
          </label>
        </div>

        <label class="label block">Request details
          <textarea class="textarea mt-1" [(ngModel)]="model.request_text" name="request_text"
            placeholder="3 scissor lifts for next weekend, Arlington TX"></textarea>
        </label>

        <div class="flex items-center gap-3 pt-2">
          <button class="btn-primary" [disabled]="loading || f.invalid" type="submit">
            <span *ngIf="!loading">Run Quote</span>
            <span *ngIf="loading" class="inline-flex items-center gap-2">
              <span class="spinner"></span> Runningâ€¦
            </span>
          </button>
          <button class="btn-ghost" type="button" (click)="reset()" [disabled]="loading">Reset</button>
        </div>
      </form>
    </section>

    <!-- Right: Results -->
    <section class="card">
      <!-- Empty -->
      <div *ngIf="!loading && !result && !error" class="empty">
        <div class="mx-auto mb-3 h-10 w-10 rounded-full bg-white/8 grid place-items-center">
          <span class="font-semibold text-white/90">i</span>
        </div>
        <p class="text-sm">Run a quote to see results here.</p>
      </div>

      <!-- Loading -->
      <div *ngIf="loading" class="space-y-3">
        <div class="skeleton h-6 w-40"></div>
        <div class="skeleton h-32 w-full"></div>
        <div class="skeleton h-5 w-2/3"></div>
      </div>

      <!-- Error -->
      <div *ngIf="!loading && error" class="alert-error">{{ error }}</div>

      <!-- Result -->
      <div *ngIf="!loading && result" class="space-y-5">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-lg font-semibold">Quote Summary</h2>
            <!-- Keep this only if your API returns completedAt at top-level -->
            <p class="text-xs text-white/60" *ngIf="result?.completedAt">Completed: {{ result.completedAt }}</p>
          </div>
          <div class="text-right">
            <div class="text-2xl font-bold">
              {{ result?.quote?.currency || '$' }}{{ (result?.quote?.total || 0) | number:'1.0-2' }}
            </div>
            <div class="text-xs text-white/60">Estimated total</div>
          </div>
        </div>

        <div class="overflow-hidden rounded-xl border border-white/10">
          <table class="table">
            <thead class="bg-white/5">
              <tr>
                <th class="text-left">Item</th>
                <th class="text-center">Qty</th>
                <th class="text-right">Unit</th>
                <th class="text-right">Subtotal</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let it of result?.quote?.items || []">
                <td>{{ it.name }}</td>
                <td class="text-center">{{ it.qty }}</td>
                <td class="text-right">{{ result?.quote?.currency || '$' }}{{ it.unitPrice | number:'1.2-2' }}</td>
                <td class="text-right font-medium">{{ result?.quote?.currency || '$' }}{{ it.subtotal | number:'1.2-2' }}</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div *ngIf="result?.quote?.notes?.length" class="space-y-2">
          <h3 class="text-sm font-semibold text-white/90">AI Notes</h3>
          <ul class="list-disc ml-5 text-sm text-white/85">
            <li *ngFor="let n of result?.quote?.notes">{{ n }}</li>
          </ul>
        </div>
      </div>
    </section>
  </div>
</div>
